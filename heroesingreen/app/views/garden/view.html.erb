<style>
	.garden {
		background-image:url('../images/Backgrounds/GardenBackgroundSmall.gif');
		width: 918px; 
		height: 714px;
	}	
	.ground {
		width: 100px;
		height: 100px;
		border: 1px black hidden; 
		float: left;
		position: relative;
	}
	.highlighted {
		border-style: dotted !important;
		opacity: 0.5;
		background: #CEF;
	}
	.highlighted:hover {
		background: #CFE;
		cursor: hand; 
		cursor: pointer;
	}
	.plant_in_garden {
		position: absolute;
		bottom: 0;
	}
	.plant_in_garden img {
		opacity: 0.9;
	}
	.plant_in_garden img:hover {
		opacity:1;
	}
	.clear {clear:both;}
</style>

<h1>Your garden!</h1>
Your garden measures your progress.

<%@plantId = params[:pl]%>

<div class="garden">
	<%@garden.size_y.times do |y|%>
		<%@garden.size_x.times do |x|%>
			<div class="ground 
			<%if (y > 3) and @plantId and @garden.is_compatible(@plantId,x,y)%> highlighted" onclick="buy(<%=@plantId%>,<%=x%>,<%=y%>)<%end%>
			">
				<%ground = @garden.grounds.find_by_x_and_y(x,y)%>
				<%if ground != nil%>
					<%ground.plants.each do |plant|%>
						<%if plant.plant_template.image_path != nil%>
							<%img_url = "plants/#{plant.plant_template.image_path}"%>
							<%if @garden.size_y - y == 1%>
								<%img_url = img_url + "a.png"%>
							<%elsif @garden.size_y - y == 2%>
								<%img_url = img_url + "b.png"%>
							<%elsif @garden.size_y - y == 3%>
								<%img_url = img_url + "c.png"%>
							<%end%>
							<div class="plant_in_garden"><%=image_tag(img_url,:title => plant.name)%><br></div>
						<%end%>
					<%end%>
				<%end%>
			</div>
		<%end%>
		<div class="clear"></div>
	<%end%>
</div>

<script>
	//Try to buy this plant, for planting at position x,y in the garden
	function buy(plantId, x, y)
	{
		if(plantId > 0 && x > 0 && y > 3 && x < 9 && y < 7)
			window.location.replace('/store/buyAndSave/' + plantId + '?x=' + x + '&y=' + y);
		else
			alert("We have a suspicion you're not green enough. Sorry, no plants for you.");	//TODO: agrandhi
	}
</script>